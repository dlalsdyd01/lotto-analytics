<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-3398247421662455">
    <title>Lotto Lab - ë¡œë˜ ë²ˆí˜¸ ë¶„ì„ & AI ì˜ˆì¸¡</title>
    <meta name="description" content="ê³¼ê±° ë¡œë˜ ë°ì´í„° ë¶„ì„ê³¼ AI ê¸°ë°˜ ë²ˆí˜¸ ì˜ˆì¸¡. í†µê³„ ë¶„ì„ìœ¼ë¡œ ë‹¹ì²¨ í™•ë¥ ì„ ë†’ì—¬ë³´ì„¸ìš”!">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Lotto Lab - ë¡œë˜ ë²ˆí˜¸ ë¶„ì„ & AI ì˜ˆì¸¡">
    <meta property="og:description" content="ê³¼ê±° ë¡œë˜ ë°ì´í„° ë¶„ì„ê³¼ AI ê¸°ë°˜ ë²ˆí˜¸ ì˜ˆì¸¡. í†µê³„ ë¶„ì„ìœ¼ë¡œ ë‹¹ì²¨ í™•ë¥ ì„ ë†’ì—¬ë³´ì„¸ìš”!">
    <meta property="og:url" content="https://lottoanalytics.co.kr">
    <meta property="og:site_name" content="Lotto Lab">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Lotto Lab - ë¡œë˜ ë²ˆí˜¸ ë¶„ì„ & AI ì˜ˆì¸¡">
    <meta name="twitter:description" content="ê³¼ê±° ë¡œë˜ ë°ì´í„° ë¶„ì„ê³¼ AI ê¸°ë°˜ ë²ˆí˜¸ ì˜ˆì¸¡"">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3358247421662455"
         crossorigin="anonymous"></script>

    <!-- Kakao SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js" integrity="sha384-l+xbElFSnPZ2rOaPrU//2FF5B4LB8FiX5q4fXYTlfcG4PGpMkE1vcL7kNXI6Cci0" crossorigin="anonymous"></script>

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-925QJ7TR52"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-925QJ7TR52');
    </script>
</head>
<body>

<header class="header">
    <div class="header-inner">
        <span class="logo">Lotto Lab</span>
        <button class="header-btn" onclick="refreshData(event)">ë°ì´í„° ê°±ì‹ </button>
    </div>
</header>

<div style="background:rgba(255,255,255,0.72); backdrop-filter:saturate(180%) blur(20px); -webkit-backdrop-filter:saturate(180%) blur(20px); border-bottom:1px solid var(--border);">
    <div class="tab-bar">
        <button class="tab-item active" data-tab="checker">ë‹¹ì²¨í™•ì¸</button>
        <button class="tab-item" data-tab="history">ë‹¹ì²¨ë²ˆí˜¸</button>
        <button class="tab-item" data-tab="stats">í†µê³„</button>
        <button class="tab-item" data-tab="prediction">ì˜ˆì¸¡</button>
    </div>
</div>

<div class="layout-wrapper">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” ê´‘ê³  -->
    <aside class="sidebar-ad sidebar-left">
        <!--
        <ins class="adsbygoogle"
             style="display:inline-block;width:160px;height:600px"
             data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
             data-ad-slot="LEFT_SIDEBAR_SLOT"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        -->
        <div style="background:#f0f0f0; width:160px; height:600px; border-radius:8px; display:flex; align-items:center; justify-content:center; color:#999; font-size:12px; text-align:center; padding:10px;">
            ì™¼ìª½<br>ì‚¬ì´ë“œë°”<br>ê´‘ê³ <br>(160x600)
        </div>
    </aside>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="container">

    <div id="loading" class="loading">
        <div class="spinner"></div>
        <div class="loading-text">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘</div>
    </div>

    <!-- ë‹¹ì²¨í™•ì¸ -->
    <div id="tab-checker" class="tab-content">
        <div class="checker-hero fade-in">
            <div class="checker-latest" id="checker-latest-info"></div>
            <div class="checker-title">ë‚´ ë²ˆí˜¸ í™•ì¸í•˜ê¸°</div>
            <div class="checker-subtitle">ë²ˆí˜¸ 6ê°œë¥¼ ì…ë ¥í•˜ê³  ìµœì‹  íšŒì°¨ ë‹¹ì²¨ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”</div>

            <div class="checker-input-wrap">
                <div class="checker-balls-input" id="checker-balls">
                    <input type="number" class="checker-num" min="1" max="45" placeholder="?" id="cn1">
                    <input type="number" class="checker-num" min="1" max="45" placeholder="?" id="cn2">
                    <input type="number" class="checker-num" min="1" max="45" placeholder="?" id="cn3">
                    <input type="number" class="checker-num" min="1" max="45" placeholder="?" id="cn4">
                    <input type="number" class="checker-num" min="1" max="45" placeholder="?" id="cn5">
                    <input type="number" class="checker-num" min="1" max="45" placeholder="?" id="cn6">
                </div>
                <div class="checker-actions">
                    <button class="checker-btn" onclick="checkMyNumbers()">ë‹¹ì²¨ í™•ì¸</button>
                    <button class="checker-quick-btn" onclick="clearChecker()">ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>

        <div id="checker-result" class="fade-in" style="display:none;">
            <div class="checker-result-card" id="checker-summary"></div>
        </div>
    </div>

    <!-- ë‹¹ì²¨ë²ˆí˜¸ -->
    <div id="tab-history" class="tab-content">
        <div class="card fade-in">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
                <div class="card-header" style="margin-bottom:0;">ì—­ëŒ€ ë‹¹ì²¨ë²ˆí˜¸</div>
                <input type="text" class="search" id="search-draw" placeholder="íšŒì°¨ ê²€ìƒ‰" oninput="searchDraws()">
            </div>
            <div style="overflow-x:auto;">
                <table class="tbl">
                    <thead>
                        <tr>
                            <th>íšŒì°¨</th>
                            <th>ì¶”ì²¨ì¼</th>
                            <th>ë‹¹ì²¨ë²ˆí˜¸</th>
                            <th>ë³´ë„ˆìŠ¤</th>
                            <th>1ë“± ë‹¹ì²¨ê¸ˆ</th>
                        </tr>
                    </thead>
                    <tbody id="draws-tbody"></tbody>
                </table>
            </div>
            <div id="pagination" class="pager"></div>
        </div>
    </div>

    <!-- í†µê³„ -->
    <div id="tab-stats" class="tab-content">
        <div class="g2 fade-in">
            <div class="card">
                <div class="card-header">ìì£¼ ë‚˜ì˜¨ ë²ˆí˜¸</div>
                <div id="hot-numbers" class="num-grid"></div>
            </div>
            <div class="card">
                <div class="card-header">ì ê²Œ ë‚˜ì˜¨ ë²ˆí˜¸</div>
                <div id="cold-numbers" class="num-grid"></div>
            </div>
        </div>

        <div class="card fade-in">
            <div class="card-header">ìµœê·¼ 50íšŒ ì¶œí˜„ ë¹ˆë„</div>
            <div class="chart-wrap"><canvas id="recentFreqChart"></canvas></div>
        </div>

        <div class="g2 fade-in">
            <div class="card">
                <div class="card-header">êµ¬ê°„ë³„ ë¹„ìœ¨</div>
                <div class="chart-wrap" style="height:260px;"><canvas id="rangeChart"></canvas></div>
            </div>
            <div class="card">
                <div class="card-header">í™€ì§ ë¶„ì„</div>
                <div id="odd-even-stats"></div>
            </div>
        </div>

        <div class="g2 fade-in">
            <div class="card">
                <div class="card-header">ì—°ì†ë²ˆí˜¸</div>
                <div id="consecutive-stats"></div>
            </div>
            <div class="card">
                <div class="card-header">ë²ˆí˜¸ í•©ê³„</div>
                <div id="sum-stats"></div>
            </div>
        </div>

    </div>

    <!-- ì˜ˆì¸¡ -->
    <div id="tab-prediction" class="tab-content">
        <div class="pred-card fade-in">
            <div class="card-header">ì¶”ì²œ ë²ˆí˜¸</div>
            <div class="pred-desc">
                ê³¼ê±° ë°ì´í„°ì˜ ì¶œí˜„ ë¹ˆë„ì™€ ìµœê·¼ íŠ¸ë Œë“œë¥¼ ë¶„ì„í•˜ì—¬ ìƒì„±ëœ ë²ˆí˜¸ì…ë‹ˆë‹¤.<br>
                ë§¤ì£¼ ì¼ìš”ì¼ì— ìƒˆë¡œìš´ ë²ˆí˜¸ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤.<br>
                ì¶”ì²œë²ˆí˜¸ëŠ” ì‚¬ìš©ìë§ˆë‹¤ ë‹¤ë¥´ê²Œ ìƒì„±ë©ë‹ˆë‹¤.
            </div>
            <div id="prediction-sets"></div>

            <!-- ê³µìœ  ë²„íŠ¼ -->
            <div class="share-section">
                <div class="share-title">ë‚´ ì˜ˆì¸¡ ë²ˆí˜¸ ê³µìœ í•˜ê¸°</div>
                <div class="share-buttons">
                    <button class="share-btn share-kakao" onclick="shareKakao()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3C6.48 3 2 6.58 2 11c0 2.89 1.91 5.43 4.78 6.85-.2.72-.75 2.64-.86 3.05-.14.51.19.5.39.37.16-.11 2.52-1.68 3.46-2.31.63.09 1.28.14 1.94.14 5.52 0 10-3.58 10-8s-4.48-8-10-8z"/>
                        </svg>
                        ì¹´ì¹´ì˜¤í†¡
                    </button>
                    <button class="share-btn share-url" onclick="copyURL()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                        </svg>
                        URL ë³µì‚¬
                    </button>
                    <button class="share-btn share-twitter" onclick="shareTwitter()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                        íŠ¸ìœ„í„°
                    </button>
                </div>
                <div id="share-result" class="share-result"></div>
            </div>
        </div>
    </div>

    </div><!-- container ë‹«ê¸° -->

    <!-- ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” ê´‘ê³  -->
    <aside class="sidebar-ad sidebar-right">
        <!--
        <ins class="adsbygoogle"
             style="display:inline-block;width:160px;height:600px"
             data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
             data-ad-slot="RIGHT_SIDEBAR_SLOT"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        -->
        <div style="background:#f0f0f0; width:160px; height:600px; border-radius:8px; display:flex; align-items:center; justify-content:center; color:#999; font-size:12px; text-align:center; padding:10px;">
            ì˜¤ë¥¸ìª½<br>ì‚¬ì´ë“œë°”<br>ê´‘ê³ <br>(160x600)
        </div>
    </aside>

</div><!-- layout-wrapper ë‹«ê¸° -->

<script>
let appData = null;
let currentPage = 1;
let charts = {};

function getBallClass(n) {
    if (n <= 10) return 'ball-1';
    if (n <= 20) return 'ball-2';
    if (n <= 30) return 'ball-3';
    if (n <= 40) return 'ball-4';
    return 'ball-5';
}

function renderBall(n, size = '', extra = '') {
    const sc = size === 'lg' ? 'ball-lg' : size === 'sm' ? 'ball-sm' : '';
    return `<span class="ball ${getBallClass(n)} ${sc} ${extra}">${n}</span>`;
}

function formatMoney(val) {
    if (!val) return '-';
    const b = val / 100000000;
    return b >= 1 ? b.toFixed(0) + 'ì–µ' : (val / 10000).toFixed(0) + 'ë§Œ';
}

// Tabs
document.querySelectorAll('.tab-item').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
    });
});

// Load
async function loadData() {
    document.getElementById('loading').style.display = 'flex';
    try {
        const resp = await fetch('/api/data');
        if (resp.status === 202) { pollStatus(); return; }
        appData = await resp.json();
        if (appData.error) { pollStatus(); return; }
        renderAll();
    } catch (e) {
        document.getElementById('loading').innerHTML =
            '<div class="loading-text">ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
    }
}

async function pollStatus() {
    const resp = await fetch('/api/status');
    const s = await resp.json();
    if (s.ready || s.cached_count > 100) { loadData(); return; }
    const pct = s.total > 0 ? Math.round(s.progress / s.total * 100) : 0;
    document.getElementById('loading').innerHTML = `
        <div class="spinner"></div>
        <div class="loading-text">ë°ì´í„° ìˆ˜ì§‘ ì¤‘ ${pct}%</div>
        <div style="width:200px;height:4px;background:var(--border);border-radius:2px;overflow:hidden;">
            <div style="width:${pct}%;height:100%;background:var(--text-2);transition:width 0.3s;"></div>
        </div>`;
    setTimeout(pollStatus, 2000);
}

function renderAll() {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('tab-checker').classList.add('active');
    renderCheckerInfo();
    renderDrawsTable();
    renderHotCold();
    renderRecentFreqChart();
    renderRangeChart();
    renderOddEven();
    renderConsecutive();
    renderSumStats();
    loadOrCreatePredictions();
}

// Hot/Cold
function renderHotCold() {
    const render = (nums, id) => {
        document.getElementById(id).innerHTML = nums.map(item => `
            <div class="num-item">
                ${renderBall(item.number)}
                <span class="num-count">${item.count}</span>
            </div>`).join('');
    };
    render(appData.analysis.hot_numbers, 'hot-numbers');
    render(appData.analysis.cold_numbers, 'cold-numbers');
}

// Draws Table
function renderDrawsTable(page = 1, search = '') {
    currentPage = page;
    fetch('/api/draws?' + new URLSearchParams({ page, per_page: 20, search }))
        .then(r => r.json())
        .then(data => {
            document.getElementById('draws-tbody').innerHTML = data.draws.map(d => `
                <tr>
                    <td><span class="draw-no">${d.draw_no}</span></td>
                    <td><span class="draw-date">${d.date}</span></td>
                    <td>
                        <div class="balls-row">
                            ${d.numbers.map(n => renderBall(n, 'sm')).join('')}
                        </div>
                    </td>
                    <td>${renderBall(d.bonus, 'sm', 'ball-bonus')}</td>
                    <td><span class="prize">${formatMoney(d.prize_1st)}</span></td>
                </tr>`).join('');
            renderPagination(data);
        });
}

function renderPagination(data) {
    const { page, total_pages } = data;
    let h = '';
    h += `<button class="pg-btn" onclick="renderDrawsTable(${page-1})" ${page===1?'disabled':''}>&lsaquo;</button>`;
    const s = Math.max(1, page - 2), e = Math.min(total_pages, page + 2);
    for (let i = s; i <= e; i++)
        h += `<button class="pg-btn ${i===page?'active':''}" onclick="renderDrawsTable(${i})">${i}</button>`;
    h += `<span class="pg-info">${page} / ${total_pages}</span>`;
    h += `<button class="pg-btn" onclick="renderDrawsTable(${page+1})" ${page===total_pages?'disabled':''}>&rsaquo;</button>`;
    document.getElementById('pagination').innerHTML = h;
}

function searchDraws() { renderDrawsTable(1, document.getElementById('search-draw').value); }

// Charts
const chartColors = n => {
    if (n <= 10) return '#ff9f0a';
    if (n <= 20) return '#64d2ff';
    if (n <= 30) return '#ff453a';
    if (n <= 40) return '#bf5af2';
    return '#30d158';
};

function renderRecentFreqChart() {
    const ctx = document.getElementById('recentFreqChart');
    if (charts['recent']) charts['recent'].destroy();
    const freq = appData.analysis.recent_frequency;
    const labels = Object.keys(freq).map(Number);
    charts['recent'] = new Chart(ctx, {
        type: 'bar',
        data: {
            labels,
            datasets: [{ data: Object.values(freq), backgroundColor: labels.map(n => chartColors(n) + 'aa'), borderRadius: 3 }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { grid: { display: false } }, y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.04)' } } }
        }
    });
}

function renderRangeChart() {
    const ctx = document.getElementById('rangeChart');
    if (charts['range']) charts['range'].destroy();
    const r = appData.analysis.range_analysis;
    charts['range'] = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(r),
            datasets: [{ data: Object.values(r), backgroundColor: ['#ff9f0a','#64d2ff','#ff453a','#bf5af2','#30d158'], borderWidth: 0 }]
        },
        options: {
            responsive: true, maintainAspectRatio: false, cutout: '65%',
            plugins: {
                legend: { position: 'bottom', labels: { padding: 16, usePointStyle: true, pointStyle: 'circle', font: { size: 12 } } },
                tooltip: { callbacks: { label: c => `${c.label}: ${c.parsed}%` } }
            }
        }
    });
}

// Odd/Even
function renderOddEven() {
    const oe = appData.analysis.odd_even;
    const op = ((oe.avg_odd/6)*100).toFixed(1), ep = ((oe.avg_even/6)*100).toFixed(1);
    const tags = oe.combos.slice(0,6).map(c =>
        `<span class="tag">${c.combo.replace(':','í™€ ')}ì§ &middot; ${c.count}íšŒ</span>`).join('');
    document.getElementById('odd-even-stats').innerHTML = `
        <div style="margin-bottom:16px;">
            <div style="font-size:14px;margin-bottom:8px;">í‰ê·  í™€ <strong>${oe.avg_odd}</strong> / ì§ <strong>${oe.avg_even}</strong></div>
            <div class="bar-track">
                <div class="bar-seg bar-odd" style="width:${op}%">${op}%</div>
                <div class="bar-seg bar-even" style="width:${ep}%">${ep}%</div>
            </div>
        </div>
        <div style="font-size:12px;color:var(--text-3);margin-bottom:8px;">ì¡°í•©ë³„ ë¹ˆë„</div>
        ${tags}`;
}

// Consecutive
function renderConsecutive() {
    const c = appData.analysis.consecutive;
    document.getElementById('consecutive-stats').innerHTML = `
        <div class="stat-block">
            <div class="stat-num">${c.percentage}%</div>
            <div class="stat-label">ì—°ì†ë²ˆí˜¸ í¬í•¨ ë¹„ìœ¨</div>
            <div style="font-size:13px;color:var(--text-2);margin-top:12px;">
                ${c.total_draws}íšŒ ì¤‘ ${c.consecutive_draws}íšŒ
            </div>
        </div>`;
}

// Sum
function renderSumStats() {
    const s = appData.analysis.sum_stats;
    document.getElementById('sum-stats').innerHTML = `
        <div class="stat-block">
            <div class="stat-num">${s.avg}</div>
            <div class="stat-label">6ê°œ ë²ˆí˜¸ í•©ê³„ í‰ê· </div>
            <div style="display:flex;justify-content:center;gap:24px;margin-top:12px;font-size:13px;color:var(--text-2);">
                <span>ìµœì†Œ ${s.min}</span>
                <span>ìµœëŒ€ ${s.max}</span>
                <span>í‘œì¤€í¸ì°¨ ${s.std}</span>
            </div>
        </div>`;
}

// Predictions
function getSundayKey() {
    const now = new Date();
    const day = now.getDay();
    const diff = day === 0 ? 0 : 7 - day;
    const sun = new Date(now);
    sun.setDate(now.getDate() + diff);
    return sun.toISOString().split('T')[0];
}

function loadOrCreatePredictions() {
    const nextDraw = appData.analysis.latest_draw.draw_no + 1;
    const key = getSundayKey();
    const stored = localStorage.getItem('lotto_predictions');
    if (stored) {
        const p = JSON.parse(stored);
        if (p.week === key) { renderPredictions(p.predictions, p.draw_no || nextDraw); return; }
    }
    fetch('/api/predict').then(r => r.json()).then(data => {
        localStorage.setItem('lotto_predictions', JSON.stringify({ week: key, draw_no: nextDraw, predictions: data.predictions }));
        renderPredictions(data.predictions, nextDraw);
    });
}

function renderPredictions(predictions, nextDraw) {
    document.getElementById('prediction-sets').innerHTML =
        `<div style="font-size:13px;color:rgba(255,255,255,0.35);margin-bottom:16px;">ì œ ${nextDraw}íšŒ</div>` +
        predictions.map((pred, i) => `
            <div class="pred-row">
                <span class="pred-label">SET ${i+1}</span>
                <div class="balls-row">${pred.map(n => renderBall(n)).join('')}</div>
            </div>`).join('');
}

// Checker
function renderCheckerInfo() {
    const draws = appData.draws;
    const latest = draws[draws.length - 1];
    document.getElementById('checker-latest-info').innerHTML =
        `<span>ì œ ${latest.draw_no}íšŒ</span><span>${latest.date}</span>`;
}

function clearChecker() {
    for (let i = 1; i <= 6; i++) document.getElementById('cn' + i).value = '';
    document.getElementById('checker-result').style.display = 'none';
}

// ì…ë ¥ì¹¸ ìë™ ì´ë™
document.querySelectorAll('.checker-num').forEach((input, idx) => {
    input.addEventListener('input', () => {
        let v = parseInt(input.value);
        if (v > 45) input.value = 45;
        if (v < 1 && input.value !== '') input.value = 1;
        if (input.value.length >= 2 && idx < 5) {
            document.getElementById('cn' + (idx + 2)).focus();
        }
    });
    input.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
            e.preventDefault();
            if (idx < 5) document.getElementById('cn' + (idx + 2)).focus();
            else checkMyNumbers();
        }
    });
});

function checkMyNumbers() {
    if (!appData) return;
    const myNums = [];
    for (let i = 1; i <= 6; i++) {
        const v = parseInt(document.getElementById('cn' + i).value);
        if (isNaN(v) || v < 1 || v > 45) {
            document.getElementById('cn' + i).focus();
            document.getElementById('cn' + i).classList.add('checker-num-error');
            setTimeout(() => document.getElementById('cn' + i).classList.remove('checker-num-error'), 800);
            return;
        }
        if (myNums.includes(v)) {
            document.getElementById('cn' + i).focus();
            document.getElementById('cn' + i).classList.add('checker-num-error');
            setTimeout(() => document.getElementById('cn' + i).classList.remove('checker-num-error'), 800);
            return;
        }
        myNums.push(v);
    }

    const draws = appData.draws;
    const latest = draws[draws.length - 1];
    const matched = myNums.filter(n => latest.numbers.includes(n));
    const bonusMatch = myNums.includes(latest.bonus);

    let rank = 0;
    if (matched.length === 6) rank = 1;
    else if (matched.length === 5 && bonusMatch) rank = 2;
    else if (matched.length === 5) rank = 3;
    else if (matched.length === 4) rank = 4;
    else if (matched.length === 3) rank = 5;

    const rankNames = { 1: '1ë“±', 2: '2ë“±', 3: '3ë“±', 4: '4ë“±', 5: '5ë“±' };
    const rankColors = { 1: '#ff3b30', 2: '#ff9f0a', 3: '#af52de', 4: '#0071e3', 5: '#34c759' };

    const resultDiv = document.getElementById('checker-result');
    resultDiv.style.display = 'block';
    const summaryDiv = document.getElementById('checker-summary');

    // ë‹¹ì²¨ë²ˆí˜¸ í‘œì‹œ (ì¼ì¹˜í•˜ë©´ ë°ê²Œ, ë¶ˆì¼ì¹˜í•˜ë©´ íë¦¬ê²Œ)
    const drawBalls = latest.numbers.map(n => {
        const isMatch = matched.includes(n);
        return `<span class="ball ${getBallClass(n)} ${isMatch ? '' : 'ball-dim'}">${n}</span>`;
    }).join('');
    const bonusBall = `<span class="ball ${getBallClass(latest.bonus)} ${bonusMatch ? '' : 'ball-dim'} ball-bonus">${latest.bonus}</span>`;

    const drawSection = `
        <div class="checker-draw-row">
            <div class="checker-draw-label">ì œ ${latest.draw_no}íšŒ ë‹¹ì²¨ë²ˆí˜¸</div>
            <div class="balls-row" style="justify-content:center;gap:10px;">
                ${drawBalls}
                <span class="balls-divider"></span>
                ${bonusBall}
            </div>
        </div>`;

    if (rank === 0) {
        summaryDiv.innerHTML = `
            <div class="checker-result-hero">
                <div class="checker-my-balls">${myNums.map(n => renderBall(n, 'lg')).join('')}</div>
                <div class="checker-result-msg">ë‚™ì²¨</div>
                <div class="checker-result-sub">${latest.date} ì¶”ì²¨ / ì¼ì¹˜ë²ˆí˜¸ ${matched.length}ê°œ</div>
                ${drawSection}
            </div>`;
    } else {
        summaryDiv.innerHTML = `
            <div class="checker-result-hero">
                <div class="checker-my-balls">${myNums.map(n => renderBall(n, 'lg')).join('')}</div>
                <div class="checker-result-rank" style="color:${rankColors[rank]}">${rankNames[rank]}</div>
                <div class="checker-result-sub">${latest.date} ì¶”ì²¨ / ì¼ì¹˜ë²ˆí˜¸ ${matched.length}ê°œ${bonusMatch ? ' + ë³´ë„ˆìŠ¤' : ''}</div>
                ${drawSection}
            </div>`;
    }

    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Refresh
async function refreshData(e) {
    const btn = e.target;
    btn.textContent = 'ê°±ì‹  ì¤‘...';
    btn.disabled = true;
    await fetch('/api/refresh');
    await loadData();
    btn.textContent = 'ë°ì´í„° ê°±ì‹ ';
    btn.disabled = false;
    // íƒ­ UIë„ ë‹¹ì²¨ë²ˆí˜¸ë¡œ ì „í™˜
    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelector('.tab-item[data-tab="checker"]').classList.add('active');
    document.getElementById('tab-checker').classList.add('active');
}

// Share Functions
function showShareResult(message, success = true) {
    const resultDiv = document.getElementById('share-result');
    resultDiv.textContent = message;
    resultDiv.className = `share-result show ${success ? 'success' : 'error'}`;
    setTimeout(() => {
        resultDiv.classList.remove('show');
    }, 3000);
}

function shareKakao() {
    if (!appData || !appData.analysis || !appData.analysis.predictions) {
        showShareResult('ì˜ˆì¸¡ ë²ˆí˜¸ë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”', false);
        return;
    }

    // Kakao SDK ì´ˆê¸°í™” (JavaScript Key í•„ìš”)
    if (typeof Kakao !== 'undefined' && !Kakao.isInitialized()) {
        // TODO: Kakao JavaScript Keyë¡œ êµì²´ í•„ìš”
        // Kakao.init('YOUR_JAVASCRIPT_KEY');
    }

    const predictions = appData.analysis.predictions;
    const nextDraw = appData.analysis.latest_draw.draw_no + 1;
    const predictionsText = predictions.slice(0, 3).map((p, i) =>
        `SET ${i+1}: ${p.join(', ')}`
    ).join('\\n');

    const shareText = `ğŸ° Lotto Lab AI ì˜ˆì¸¡ ë²ˆí˜¸\\nì œ ${nextDraw}íšŒ\\n\\n${predictionsText}\\n\\ní†µê³„ ë¶„ì„ ê¸°ë°˜ AI ì˜ˆì¸¡ âœ¨`;

    // ì¹´ì¹´ì˜¤í†¡ ê³µìœ  (SDK ì„¤ì • í•„ìš”)
    if (typeof Kakao !== 'undefined' && Kakao.isInitialized()) {
        Kakao.Share.sendDefault({
            objectType: 'text',
            text: shareText,
            link: {
                mobileWebUrl: window.location.href,
                webUrl: window.location.href,
            }
        });
    } else {
        // SDK ë¯¸ì„¤ì • ì‹œ í…ìŠ¤íŠ¸ ë³µì‚¬
        navigator.clipboard.writeText(shareText).then(() => {
            showShareResult('ì˜ˆì¸¡ ë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ì¹´ì¹´ì˜¤í†¡ì— ë¶™ì—¬ë„£ê¸°í•˜ì„¸ìš” ğŸ“‹');
        }).catch(() => {
            showShareResult('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', false);
        });
    }
}

function copyURL() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
        showShareResult('URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
    }).catch(() => {
        showShareResult('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', false);
    });
}

function shareTwitter() {
    if (!appData || !appData.analysis || !appData.analysis.predictions) {
        showShareResult('ì˜ˆì¸¡ ë²ˆí˜¸ë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”', false);
        return;
    }

    const predictions = appData.analysis.predictions;
    const nextDraw = appData.analysis.latest_draw.draw_no + 1;
    const predictionsText = predictions.slice(0, 2).map((p, i) =>
        `SET ${i+1}: ${p.join(', ')}`
    ).join('\\n');

    const shareText = `ğŸ° Lotto Lab AI ì˜ˆì¸¡ ë²ˆí˜¸\\nì œ ${nextDraw}íšŒ\\n${predictionsText}\\n\\ní†µê³„ ë¶„ì„ ê¸°ë°˜ AI ì˜ˆì¸¡`;
    const url = window.location.href;
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(url)}`;

    window.open(twitterUrl, '_blank', 'width=550,height=420');
}

loadData();
</script>
</body>
</html>
